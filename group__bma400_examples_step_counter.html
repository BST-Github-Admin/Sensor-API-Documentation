<!-- Generated by Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Step counter<div class="ingroups"><a class="el" href="group__bma400.html">BMA400</a> &raquo; <a class="el" href="group__bma400_examples.html">Examples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>To showcase step counter feature. </p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Copyright (C) 2019 Bosch Sensortec GmbH</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * License is available in the root folder</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;bma400.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;bma400_hal_custom.h&quot;</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_rslt(int8_t rslt);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>bma400_dev bma;</div><div class="line">    <span class="keyword">struct </span>bma400_int_enable step_int;</div><div class="line">    int8_t rslt;</div><div class="line">    uint8_t test_dur = 30;</div><div class="line">    uint32_t step_count;</div><div class="line">    uint8_t activity;</div><div class="line"></div><div class="line">    bma400_example_hal_init();</div><div class="line"></div><div class="line">    <span class="comment">/* Bus configuration : I2C*/</span></div><div class="line">    bma.dev_id = BMA400_I2C_ADDRESS_SDO_LOW;</div><div class="line">    bma.intf = BMA400_I2C_INTF;</div><div class="line"></div><div class="line">    <span class="comment">/* For SPI un-comment following code */</span></div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * bma.dev_id = 0; //  Could be used to identify the chip select line</span></div><div class="line"><span class="comment">     * bma.intf = BMA400_SPI_INTF;</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    bma.delay_ms = bma400_example_hal_delay_ms;</div><div class="line">    bma.read = bma400_example_hal_bus_read;</div><div class="line">    bma.write = bma400_example_hal_bus_write;</div><div class="line"></div><div class="line">    rslt = bma400_init(&amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    rslt = bma400_soft_reset(&amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    step_int.type = BMA400_STEP_COUNTER_INT_EN;</div><div class="line">    step_int.conf = BMA400_ENABLE;</div><div class="line"></div><div class="line">    rslt = bma400_enable_interrupt(&amp;step_int, 1, &amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    rslt = bma400_set_power_mode(BMA400_NORMAL_MODE, &amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Steps counted, Activity classifier\r\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (test_dur)</div><div class="line">    {</div><div class="line">        bma.delay_ms(1000);</div><div class="line"></div><div class="line">        rslt = bma400_get_steps_counted(&amp;step_count, &amp;activity, &amp;bma);</div><div class="line">        printf(<span class="stringliteral">&quot;%ld&quot;</span>, step_count);</div><div class="line"></div><div class="line">        <span class="keywordflow">switch</span> (activity)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">case</span> BMA400_STILL_ACT:</div><div class="line">                printf(<span class="stringliteral">&quot;, Still\r\n&quot;</span>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> BMA400_WALK_ACT:</div><div class="line">                printf(<span class="stringliteral">&quot;, Walking\r\n&quot;</span>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> BMA400_RUN_ACT:</div><div class="line">                printf(<span class="stringliteral">&quot;, Running\r\n&quot;</span>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                printf(<span class="stringliteral">&quot;, undefined\r\n&quot;</span>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        test_dur--;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_rslt(int8_t rslt)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (rslt)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> BMA400_OK:</div><div class="line"></div><div class="line">            <span class="comment">/* Do nothing */</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_NULL_PTR:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Null pointer\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_COM_FAIL:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Communication failure\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_DEV_NOT_FOUND:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Device not found\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_INVALID_CONFIG:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Invalid configuration\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_W_SELF_TEST_FAIL:</div><div class="line">            printf(<span class="stringliteral">&quot;Warning [%d] : Self test failed\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Unknown error code\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
