<!-- Generated by Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tap detection<div class="ingroups"><a class="el" href="group__bma400.html">BMA400</a> &raquo; <a class="el" href="group__bma400_examples.html">Examples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>To showcase tap detection feature. </p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Copyright (C) 2019 Bosch Sensortec GmbH</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * License is available in the root folder</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;bma400.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;bma400_hal_custom.h&quot;</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_rslt(int8_t rslt);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>bma400_dev bma;</div><div class="line">    <span class="keyword">struct </span>bma400_int_enable tap_int[2];</div><div class="line">    <span class="keyword">struct </span>bma400_sensor_conf conf[2];</div><div class="line">    int8_t rslt;</div><div class="line">    uint32_t poll_period = 5, test_dur_ms = 30000;</div><div class="line">    uint16_t int_status;</div><div class="line"></div><div class="line">    bma400_example_hal_init();</div><div class="line"></div><div class="line">    <span class="comment">/* Bus configuration : I2C*/</span></div><div class="line">    bma.dev_id = BMA400_I2C_ADDRESS_SDO_LOW;</div><div class="line">    bma.intf = BMA400_I2C_INTF;</div><div class="line"></div><div class="line">    <span class="comment">/* For SPI un-comment following code */</span></div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * bma.dev_id = 0; //  Could be used to identify the chip select line</span></div><div class="line"><span class="comment">     * bma.intf = BMA400_SPI_INTF;</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    bma.delay_ms = bma400_example_hal_delay_ms;</div><div class="line">    bma.read = bma400_example_hal_bus_read;</div><div class="line">    bma.write = bma400_example_hal_bus_write;</div><div class="line"></div><div class="line">    rslt = bma400_init(&amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    rslt = bma400_soft_reset(&amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    conf[0].type = BMA400_ACCEL;</div><div class="line">    conf[1].type = BMA400_TAP_INT;</div><div class="line"></div><div class="line">    rslt = bma400_get_sensor_conf(conf, 2, &amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    conf[0].param.accel.odr = BMA400_ODR_200HZ;</div><div class="line">    conf[0].param.accel.range = BMA400_4G_RANGE;</div><div class="line">    conf[0].param.accel.data_src = BMA400_DATA_SRC_ACCEL_FILT_1;</div><div class="line">    conf[0].param.accel.filt1_bw = BMA400_ACCEL_FILT1_BW_1;</div><div class="line"></div><div class="line">    conf[1].param.tap.int_chan = BMA400_UNMAP_INT_PIN;</div><div class="line">    conf[1].param.tap.axes_sel = BMA400_Z_AXIS_EN_TAP;</div><div class="line">    conf[1].param.tap.sensitivity = BMA400_TAP_SENSITIVITY_0;</div><div class="line"></div><div class="line">    rslt = bma400_set_sensor_conf(conf, 2, &amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    bma.delay_ms(100);</div><div class="line"></div><div class="line">    tap_int[0].type = BMA400_SINGLE_TAP_INT_EN;</div><div class="line">    tap_int[0].conf = BMA400_ENABLE;</div><div class="line"></div><div class="line">    tap_int[1].type = BMA400_DOUBLE_TAP_INT_EN;</div><div class="line">    tap_int[1].conf = BMA400_ENABLE;</div><div class="line"></div><div class="line">    rslt = bma400_enable_interrupt(tap_int, 2, &amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    bma.delay_ms(100);</div><div class="line"></div><div class="line">    rslt = bma400_set_power_mode(BMA400_NORMAL_MODE, &amp;bma);</div><div class="line">    print_rslt(rslt);</div><div class="line"></div><div class="line">    bma.delay_ms(100);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (rslt == BMA400_OK)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;Tap configured.\r\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span> (test_dur_ms)</div><div class="line">        {</div><div class="line">            bma.delay_ms(poll_period);</div><div class="line"></div><div class="line">            rslt = bma400_get_interrupt_status(&amp;int_status, &amp;bma);</div><div class="line">            print_rslt(rslt);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (int_status &amp; BMA400_S_TAP_INT_ASSERTED)</div><div class="line">            {</div><div class="line">                printf(<span class="stringliteral">&quot;Single tap detected!\r\n&quot;</span>);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (int_status &amp; BMA400_D_TAP_INT_ASSERTED)</div><div class="line">            {</div><div class="line">                printf(<span class="stringliteral">&quot;Double tap detected!\r\n&quot;</span>);</div><div class="line">            }</div><div class="line"></div><div class="line">            test_dur_ms -= poll_period;</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_rslt(int8_t rslt)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (rslt)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> BMA400_OK:</div><div class="line"></div><div class="line">            <span class="comment">/* Do nothing */</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_NULL_PTR:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Null pointer\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_COM_FAIL:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Communication failure\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_DEV_NOT_FOUND:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Device not found\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_E_INVALID_CONFIG:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Invalid configuration\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> BMA400_W_SELF_TEST_FAIL:</div><div class="line">            printf(<span class="stringliteral">&quot;Warning [%d] : Self test failed\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            printf(<span class="stringliteral">&quot;Error [%d] : Unknown error code\r\n&quot;</span>, rslt);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
